{"uid":"17afba32d926951c","name":"test_encrypt","historyId":"pytest:macsec.test_macsec_stats#test_encrypt","time":{"start":1765452139269,"stop":1765452204962,"duration":65693},"status":"failed","statusMessage":"assert 4 == 2\n +  where 4 = len(<snappi.snappi.MacsecMetricIter object at 0x7f797881da00>)\n +    where <snappi.snappi.MacsecMetricIter object at 0x7f797881da00> = <snappi.snappi.MetricsResponse object at 0x7f7978163740>.macsec_metrics","statusTrace":"api = <snappi_ixnetwork.snappi_api.Api object at 0x7f7978b5c2e0>\nb2b_raw_config = <snappi.snappi.Config object at 0x7f79782c3d80>\nutils = <module 'utils' from '/home/github-runner/actions-runner/_work/snappi-ixnetwork/snappi-ixnetwork/tests/utils/__init__.py'>\n\n    def test_encrypt(api, b2b_raw_config, utils):\n        \"\"\"\n        Test for the macsec configuration\n        \"\"\"\n        api.set_config(api.config())\n        b2b_raw_config.flows.clear()\n    \n        p1, p2 = b2b_raw_config.ports\n        d1, d2 = b2b_raw_config.devices.device(name=\"enc_only_macsec1\").device(\n            name=\"enc_only_macsec2\"\n        )\n    \n        eth1, eth2 = d1.ethernets.add(), d2.ethernets.add()\n        eth1.connection.port_name, eth2.connection.port_name = p1.name, p2.name\n        eth1.mac, eth2.mac = \"00:00:00:00:00:11\", \"00:00:00:00:00:22\"\n        ip1, ip2 = eth1.ipv4_addresses.add(), eth2.ipv4_addresses.add()\n        eth1.name, eth2.name = \"eth1\", \"eth2\"\n        ip1.name, ip2.name = \"ip1\", \"ip2\"\n    \n        macsec1, macsec2 = d1.macsec, d2.macsec\n        macsec1_int, macsec2_int = macsec1.ethernet_interfaces.add(), macsec2.ethernet_interfaces.add()\n        macsec1_int.eth_name, macsec2_int.eth_name = eth1.name, eth2.name\n        secy1, secy2 = macsec1_int.secure_entity, macsec2_int.secure_entity\n        secy1.name, secy2.name = \"macsec1\", \"macsec2\"\n    \n        # Data plane and crypto engine\n        secy1.data_plane.choice = secy2.data_plane.choice = \"encapsulation\"\n        secy1.data_plane.encapsulation.crypto_engine.choice = secy2.data_plane.encapsulation.crypto_engine.choice = \"encrypt_only\"\n        secy1_crypto_engine_enc_only, secy2_crypto_engine_enc_only = secy1.data_plane.encapsulation.crypto_engine.encrypt_only, secy2.data_plane.encapsulation.crypto_engine.encrypt_only\n    \n        # Data plane Tx SC PN\n        secy1_dataplane_txsc1, secy2_dataplane_txsc1 = secy1_crypto_engine_enc_only.secure_channels.add(), secy2_crypto_engine_enc_only.secure_channels.add()\n        secy1_dataplane_txsc1.tx_pn.choice = secy2_dataplane_txsc1.tx_pn.choice = \"fixed_pn\"\n        secy1_dataplane_txsc1.tx_pn.fixed.pn = secy2_dataplane_txsc1.tx_pn.fixed.pn = 100\n    \n        # static key\n        secy1_key_gen_proto, secy2_key_gen_proto = secy1.key_generation_protocol, secy2.key_generation_protocol\n        secy1_key_gen_proto.choice = secy2_key_gen_proto.choice = \"static_key\"\n        secy1_sk, secy2_sk = secy1_key_gen_proto.static_key, secy2_key_gen_proto.static_key\n        secy1_sk.cipher_suite = secy2_sk.cipher_suite = \"gcm_aes_xpn_128\"\n    \n        # Tx\n        secy1_tx, secy2_tx = secy1_sk.tx, secy2_sk.tx\n        secy1_txsc1, secy2_txsc1 = secy1_tx.secure_channels.add(), secy2_tx.secure_channels.add()\n    \n        # Tx SC end station\n        #secy1_txsc1.end_station = secy2_txsc1.end_station = True\n    \n        # Tx key\n        secy1_tx_sak1, secy2_tx_sak1 = secy1_txsc1.saks.add(), secy2_txsc1.saks.add()\n        #secy1_tx_sak1.sak = secy2_tx_sak1.sak = \"0xF123456789ABCDEF0123456789ABCDEF\"\n        secy1_tx_sak1.sak = secy2_tx_sak1.sak = \"f123456789abcdef0123456789abcdef\"\n        secy1_tx_sak1.ssci = secy2_tx_sak1.ssci = \"0000000a\"\n        secy1_tx_sak1.salt = secy2_tx_sak1.salt = \"00000000000000000000000b\"\n    \n        # Remaining Tx SC settings autofilled\n    \n        # Rx: Not required for stateless enryption only traffic\n        #secy1_rx, secy2_rx = secy1.rx, secy2.rx\n        #secy1_rxsc1, secy2_rxsc1 = secy1.rx.static_key.scs.add(), secy2.rx.static_key.scs.add()\n    \n        # Rx SC\n        #secy1_rxsc1.dut_system_id =  eth2.mac\n        #secy2_rxsc1.dut_system_id =  eth1.mac\n    \n        # Rx key\n        #secy1_rx_sak1, secy2_rx_sak1 = secy1_rxsc1.saks.add(), secy2_rxsc1.saks.add()\n        #secy1_rx_sak1.sak = secy2_rx_sak1.sak = \"0xF123456789ABCDEF0123456789ABCDEF\"\n        #secy1_rx_sak1.sak = secy2_rx_sak1.sak = \"f123456789abcdef0123456789abcdef\"\n    \n        # Remaining Rx SC settings autofilled\n    \n        # Gratuitous ARP is sent so that DUT can learn our IP. Grat ARP source/destination are local address\n        # DUT MAC needs to be configured manually stateless encyption only engine cannot decrypt any packet including DUT ARP\n    \n        ip1.address = \"10.1.1.1\"\n        ip2.address = \"10.1.1.2\"\n    \n        ip1.prefix = 24\n        ip2.prefix = 24\n    \n        ip1.gateway = ip2.address\n        ip2.gateway = ip1.address\n    \n        ip1.gateway_mac.choice = \"value\"\n        ip1.gateway_mac.value = eth2.mac\n    \n        ip2.gateway_mac.choice = \"value\"\n        ip2.gateway_mac.value = eth1.mac\n    \n        utils.start_traffic(api, b2b_raw_config)\n    \n        utils.wait_for(\n            lambda: results_ok(api), \"stats to be as expected\", timeout_seconds=30\n        )\n        enums = [\n            \"session_state\",\n            \"out_pkts_protected\",\n            \"out_pkts_encrypted\",\n            \"in_pkts_ok\",\n            \"in_pkts_bad\",\n            \"in_pkts_bad_tag\",\n            \"in_pkts_late\",\n            \"in_pkts_no_sci\",\n            \"in_pkts_not_using_sa\",\n            \"in_pkts_not_valid\",\n            \"in_pkts_unknown_sci\",\n            \"in_pkts_unused_sa\",\n            \"in_pkts_invalid\",\n            \"in_pkts_untagged\",\n            \"out_octets_protected\",\n            \"out_octets_encrypted\",\n            \"in_octets_validated\",\n            \"in_octets_decrypted\",\n        ]\n        expected_results = {\n            \"enc_only_macsec1\": [\"up\", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            \"enc_only_macsec2\": [\"up\", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n        }\n        req = api.metrics_request()\n        req.macsec.secure_entity_names = [\"enc_only_macsec1\"]\n        results = api.get_metrics(req)\n        # assert len(results.macsec_metrics) == 2\n        assert results.macsec_metrics[0].name == \"enc_only_macsec1\"\n        print(f\"MACsec Result : enc_only_macsec1\")\n        for macsec_res in results.macsec_metrics:\n            for i, enum in enumerate(enums):\n                val = expected_results[macsec_res.name][i]\n                if \"session_state\" in enum:\n                    assert getattr(macsec_res, enum) == val\n                else:\n                    assert getattr(macsec_res, enum) >= val\n                print(f\"{enum} : {getattr(macsec_res, enum)}\")\n    \n        req = api.metrics_request()\n        req.macsec.secure_entity_names = [\"enc_only_macsec2\"]\n        results = api.get_metrics(req)\n    \n        # assert len(results.macsec_metrics) == 1\n        assert results.macsec_metrics[0].name == \"enc_only_macsec2\"\n        print(f\"MACsec Result : enc_only_macsec2\")\n        for macsec_res in results.macsec_metrics:\n            for i, enum in enumerate(enums):\n                val = expected_results[macsec_res.name][i]\n                if \"session_state\" in enum:\n                    assert getattr(macsec_res, enum) == val\n                else:\n                    assert getattr(macsec_res, enum) >= val\n                print(f\"{enum} : {getattr(macsec_res, enum)}\")\n    \n        req = api.metrics_request()\n        req.macsec.column_names = [\"session_state\"]\n        results = api.get_metrics(req)\n>       assert len(results.macsec_metrics) == 2\nE       assert 4 == 2\nE        +  where 4 = len(<snappi.snappi.MacsecMetricIter object at 0x7f797881da00>)\nE        +    where <snappi.snappi.MacsecMetricIter object at 0x7f797881da00> = <snappi.snappi.MetricsResponse object at 0x7f7978163740>.macsec_metrics\n\ntests/macsec/test_macsec_stats.py:159: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"steps":[{"name":"--------------------------------- Captured Log ---------------------------------","time":{},"steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"WARNING  root:snappi_api.py:1522 tx connectedLinkDown","time":{},"steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"WARNING  root:snappi_api.py:1522 rx connectedLinkDown","time":{},"steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"--------------------------------- Captured Out ---------------------------------","time":{},"steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":4,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"resultFormat","value":"junit"},{"name":"suite","value":"pytest"},{"name":"host","value":"snappi-ixn-ci-novus10g"},{"name":"testClass","value":"macsec.test_macsec_stats"},{"name":"package","value":"macsec.test_macsec_stats"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":67,"broken":0,"skipped":1,"passed":167,"unknown":0,"total":235},"items":[{"uid":"52aeccbc45ec35e4","status":"passed","time":{"start":1765442576325,"stop":1765442650875,"duration":74550}},{"uid":"c8a4c61654b945bc","status":"passed","time":{"start":1765433708748,"stop":1765433781419,"duration":72671}},{"uid":"7bf1f33f74bc299a","status":"passed","time":{"start":1765424930744,"stop":1765425001087,"duration":70343}},{"uid":"82ebd84f725696ae","status":"passed","time":{"start":1765398148379,"stop":1765398219532,"duration":71153}},{"uid":"eeaf58fc066476a1","status":"passed","time":{"start":1765388942440,"stop":1765389014719,"duration":72279}},{"uid":"9812056dea4b153e","status":"passed","time":{"start":1765380294965,"stop":1765380367832,"duration":72867}},{"uid":"9ae0505e3ccc0449","status":"passed","time":{"start":1765371542819,"stop":1765371619950,"duration":77131}},{"uid":"8cbf5d8d95d73f46","status":"passed","time":{"start":1765362766459,"stop":1765362840617,"duration":74158}},{"uid":"443ae8ae14c8e9cd","status":"passed","time":{"start":1764795769034,"stop":1764795844895,"duration":75861}},{"uid":"d32013834c54390a","status":"passed","time":{"start":1764786897413,"stop":1764786969156,"duration":71743}},{"uid":"6bd44d368a5a50a","status":"passed","time":{"start":1764697223756,"stop":1764697298943,"duration":75187}},{"uid":"a0b791f79b9ff9e5","status":"passed","time":{"start":1764688681148,"stop":1764688747832,"duration":66684}},{"uid":"574b493ad8a94631","status":"passed","time":{"start":1764679168772,"stop":1764679237966,"duration":69194}},{"uid":"3ccf7c9817264638","status":"passed","time":{"start":1764670230219,"stop":1764670306470,"duration":76251}},{"uid":"9cf5da9964ec81fb","status":"passed","time":{"start":1764652307998,"stop":1764652381366,"duration":73368}},{"uid":"d26260a53ac5b085","status":"passed","time":{"start":1764619810153,"stop":1764619884792,"duration":74639}},{"uid":"25d008f5f4d01439","status":"passed","time":{"start":1764603373458,"stop":1764603442765,"duration":69307}},{"uid":"708f7b1e3875b1e0","status":"passed","time":{"start":1764595598403,"stop":1764595666510,"duration":68107}},{"uid":"3cece7abd302cae3","status":"passed","time":{"start":1764587889065,"stop":1764587956830,"duration":67765}},{"uid":"df91ef76b6bed909","status":"passed","time":{"start":1764231998352,"stop":1764232068129,"duration":69777}}]},"tags":[]},"source":"17afba32d926951c.json","parameterValues":[]}